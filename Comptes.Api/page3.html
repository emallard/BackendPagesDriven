<html>

<head>
    <meta charset="UTF8">
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" href="/jquery.dataTables.min.css">

</head>

<body>

    <script src="/jquery-3.3.1.js"></script>
    <script src="/jquery.dataTables.min.js"></script>
    <script src="/render.js"></script>
    <script src="/renderForm.js"></script>
    <script src="/renderPage.js"></script>
    <script src="/renderSpecific.js"></script>
    <script src="/renderUtils.js"></script>
    <script src="/drawInGraph.js"></script>
    <!--
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Navbar</a>
    </nav>
    -->
    <div class="container">
        <div id='pagename'></div>
        <div id='content'></div>
        <div id='bindings' style="font-size: 12px"></div>


        <script>
            var _page = null;

            async function init() {
                let myHeaders = new Headers();
                //myHeaders.append('Content-Type', 'application/json');
                let pageGet = '/api' + document.location.pathname + document.location.search;//document.location.href.replace('/pages', '/api');
                let response = await fetch(pageGet,
                    {
                        headers: myHeaders,
                        method: 'GET'
                    });

                let txt = await response.text();
                _page = JSON.parse(txt);
                console.log(_page);

                renderTo(_page, '', document.getElementById('content'));
            }

            init();

            async function call(callObj) {
                let myHeaders = new Headers();
                myHeaders.append('Content-Type', 'application/json');
                let response = await fetch('/api/call',
                    {
                        headers: myHeaders,
                        method: 'POST',
                        body: JSON.stringify(callObj)
                    });

                //let contentType = response.headers.get('Content-Type');
                //console.log('contentType ' + contentType)
                return await response.json();
            }

            async function formCall(callObj) {
                let response = await call(callObj);
                console.log(response);

                if (response['href'] != null) {
                    console.log('redirect to : ' + response['href']);
                    document.location.href = response['href'].replace('/api', '');
                }
            }





        </script>
</body>

</html>